# 5240 PcOff Agent 통합 테스트 시나리오 (설계 기준)

본 문서는 현재 등록된 설계/요구사항(PRD/TRD/API/로그 코드)을 기준으로 QA에서 바로 실행 가능한 테스트 시나리오를 정리한 것이다.

---

## 1) 테스트 기준 문서

- PRD: `PRD_5240_PcOff_Electron.md`
- TRD: `TRD_5240_PcOff_Electron.md`
- Agent API: `PC_OFF_AGENT_API.md`
- 로그코드: `docs/operations/logcode.md`
- 비개발자 실행 가이드: `docs/테스트_가이드_비개발자.md`

---

## 2) 공통 사전 조건

- OS: Windows 11 / macOS 14 이상 각 1대
- 테스트 계정: 일반 사용자, 관리자(승인/OTP), 잠금해제 가능 계정
- 네트워크 제어: 정상/지연/단절을 전환 가능한 환경
- 앱 실행: `npm install && npm run build && npm start`
- 로그 확인 위치: `logs/YYYY-MM-DD.json`, `leave-seat-queue.jsonl`, `offline-state.json`

---

## 3) 핵심 시나리오 매트릭스

| ID | 시나리오 | 연관 요구사항 |
|---|---|---|
| TS-01 | 로그인 성공/실패 및 상태 복원 | FR-01, FR-02 |
| TS-02 | 잠금 화면(시업/이석/종업) 표시 규칙 | FR-01, FR-11, FR-13 |
| TS-03 | 임시연장/긴급사용/PC-ON/PC-OFF 동작 | FR-01 |
| TS-04 | 자동 업데이트 무확인 적용 | FR-03 |
| TS-05 | 업데이트 실패 재시도/롤백 | FR-03, NFR-02 |
| TS-06 | 비밀번호 변경 Confirm-Only | FR-04 |
| TS-07 | Agent Guard 무결성 탐지/복구 | FR-07 |
| TS-08 | Ops Observer 장애 이벤트 전송 | FR-08 |
| TS-09 | 설치자 레지스트리 등록/조회 | FR-09 |
| TS-10 | 이석 감지(Idle/절전) 및 화면 전환 | FR-11 |
| TS-11 | 이석 시작/종료 이벤트 전송/재시도 큐 | FR-12 |
| TS-12 | 고객사 정책(Draft/Publish/Rollback) 반영 | FR-14 |
| TS-13 | 긴급해제 비밀번호/실패 제한/만료 복귀 | FR-15 |
| TS-14 | 트레이 작동정보 실시간 갱신 | FR-16 |
| TS-15 | 오프라인 30분 유예 후 잠금/복구 | FR-17 |
| TS-16 | 프로세스 Kill OTP 통제 | FR-18 |
| TS-17 | 설치/삭제 정책 및 자동 복구 | FR-19 |
| TS-18 | 시뮬레이터 시나리오 CI 검증 | FR-05, NFR-04 |

---

## 4) 상세 테스트 시나리오

### TS-01 로그인 성공/실패 및 상태 복원

- **목적**: 로그인 플로우와 재실행 시 상태 복원을 검증한다.
- **절차**
  1. 전화번호 입력 후 서비스 영역 조회.
  2. 정상 ID/PW 로그인.
  3. 앱 재시작 후 잠금(메인) 화면 자동 진입 확인.
  4. 잘못된 PW로 로그인 실패 메시지 확인.
- **기대 결과**
  - 성공 시 잠금 화면 진입, 실패 시 오류 메시지 표시.
  - `LOGIN_SUCCESS`, 인증 실패 로그가 JSONL에 기록.

### TS-02 잠금 화면 표시 규칙 (시업/이석/종업)

- **목적**: 근태/시간 규칙에 따라 올바른 잠금 화면이 표시되는지 확인한다.
- **절차**
  1. 시업 전 PC-ON 허용 시간 안/밖 각각 실행.
  2. 종업 시각 이후 및 임시연장 허용시간 경계값 테스트.
  3. 이석 발생 시 이석 화면 전환 확인.
- **기대 결과**
  - 조건별로 `LOCKED_BEFORE`, `LOCKED_OFF`, `LOCKED_LEAVE`가 일치.

### TS-03 임시연장/긴급사용/PC-ON/PC-OFF

- **목적**: 메인 액션 버튼의 서버 연동/상태 전환을 검증한다.
- **절차**
  1. 임시연장 요청 → 승인/거절 케이스 확인.
  2. 긴급사용 사유 200자, 201자 입력 경계 테스트.
  3. PC-ON 후 잠금 해제(최소화) 확인.
  4. PC-OFF 후 잠금 유지 확인.
- **기대 결과**
  - 성공/실패 토스트와 서버 응답이 일치.
  - 사유 필드는 200자 초과 시 차단 또는 절단 정책대로 처리.

### TS-04 자동 업데이트 무확인 적용

- **목적**: 사용자 확인 없이 다운로드/적용되는지 확인한다.
- **절차**
  1. 업데이트 서버에 신규 버전 배포.
  2. 클라이언트에서 감지 이벤트 발생.
  3. 사용자 승인 UI 없이 다운로드/적용/재시작 확인.
- **기대 결과**
  - `UPDATE_FOUND` → `UPDATE_DOWNLOADED` → `UPDATE_APPLIED` 순서 기록.

### TS-05 업데이트 실패 재시도/롤백

- **목적**: 실패 시 재시도 큐와 롤백을 검증한다.
- **절차**
  1. 손상 패키지 또는 네트워크 중단으로 업데이트 실패 유도.
  2. `update/retry-queue.json` 생성 및 재시도 확인.
  3. 적용 실패 시 이전 버전 유지 확인.
- **기대 결과**
  - 앱 사용 가능 상태 유지, 실패 이력/재시도 횟수 기록.

### TS-06 비밀번호 변경 Confirm-Only

- **목적**: 비밀번호 검증 없이 확인 UI만 노출되는지 검증한다.
- **절차**
  1. 비밀번호 변경 이벤트 시뮬레이션.
  2. 사용자 확인 버튼 클릭.
- **기대 결과**
  - `PASSWORD_CHANGE_DETECTED`, `PASSWORD_CONFIRM_DONE` 기록.
  - 추가 재인증/비밀번호 일치 검증 로직 없음.

### TS-07 Agent Guard 무결성 탐지/복구

- **목적**: 파일 변조/삭제 시 탐지 및 복구를 검증한다.
- **절차**
  1. 기준선 캡처 후 감시 대상 파일 변경.
  2. 무결성 검증 실행.
  3. 복구 트리거 및 상태 조회.
- **기대 결과**
  - `AGENT_TAMPER_DETECTED`, `AGENT_RECOVERED` 로그 기록.

### TS-08 Ops Observer 장애 이벤트 전송

- **목적**: 충돌/통신두절 이벤트가 중앙으로 보고되는지 검증한다.
- **절차**
  1. 오프라인 상태를 유도하고 heartbeat 중단.
  2. Crash/Offline 이벤트 보고 호출.
- **기대 결과**
  - 로컬 로그 적재 후 온라인 복구 시 배치 업로드.

### TS-09 설치자 레지스트리 등록/조회

- **목적**: 설치자 메타데이터가 서버에 등록/조회 가능한지 확인한다.
- **절차**
  1. 설치 시 계정/사번/기기/시간 수집.
  2. 서버 동기화 후 관리자 조회.
- **기대 결과**
  - 조회/필터 결과가 설치 시점 데이터와 일치.

### TS-10 이석 감지(Idle/절전)

- **목적**: Idle 폴링/절전 복귀 감지를 검증한다.
- **절차**
  1. `leaveSeatTime` 보다 긴 무입력 유지.
  2. 절전 진입 후 임계시간 초과 복귀.
- **기대 결과**
  - 이석 화면 전환, 감지 시각 표기 규칙 준수.

### TS-11 이석 시작/종료 이벤트 전송/재시도

- **목적**: `LEAVE_SEAT_START/END`의 전송 신뢰성과 데이터 위생을 검증한다.
- **절차**
  1. 이석 시작/복귀를 반복 발생.
  2. 전송 실패 상태에서 큐 적재 확인.
  3. 온라인 복구 후 재전송 확인.
  4. reason 제어문자/장문 입력 검증.
- **기대 결과**
  - `leaveSeatSessionId`, `workSessionId` 매핑 유지.
  - reason 200자 제한, 마스킹/정제 적용.

### TS-12 고객사 정책 반영(Draft/Publish/Rollback)

- **목적**: 잠금 문구/이미지/로고/보안 정책의 동적 반영을 확인한다.
- **절차**
  1. 콘솔에서 Draft 정책 생성.
  2. Publish 후 클라이언트 즉시 반영 확인.
  3. Rollback 수행 후 이전 버전 복귀 확인.
- **기대 결과**
  - Push + Polling 하이브리드로 캐시 업데이트.
  - 역할 권한(VIEWER/EDITOR/APPROVER/ADMIN) 제약 준수.

### TS-13 긴급해제 정책 검증

- **목적**: 비밀번호 검증, 실패 제한, 만료 복귀를 검증한다.
- **절차**
  1. 올바른 비밀번호로 긴급해제 성공.
  2. 틀린 비밀번호 6회 연속 입력.
  3. 차단(5분) 이후 재시도.
  4. 성공 후 3시간 경과 시 자동 복귀 확인.
- **기대 결과**
  - 실패 5회 초과 시 차단, 만료 시 정책 화면 복귀.

### TS-14 트레이 작동정보 실시간 갱신

- **목적**: 근태/버전/현재 모드가 트레이에 즉시 반영되는지 확인한다.
- **절차**
  1. NORMAL → TEMP_EXTEND → EMERGENCY_USE 모드 전환.
  2. 트레이 메뉴 재열기.
- **기대 결과**
  - 모드 변경 이벤트와 트레이 표시값 일치.

### TS-15 오프라인 30분 유예/잠금/복구

- **목적**: 오프라인 복구 정책을 검증한다.
- **절차**
  1. 네트워크 단절 후 오프라인 안내화면 진입.
  2. 30분 경과 시 잠금 상태 전환.
  3. 네트워크 복구 후 재시도.
- **기대 결과**
  - `OFFLINE_GRACE` → `OFFLINE_LOCKED` 상태 전환.
  - 복구 이벤트 및 잠금 해제 결과가 로그에 기록.

### TS-16 프로세스 Kill OTP 통제

- **목적**: 관리자 OTP 기반 종료 통제를 검증한다.
- **절차**
  1. 일반 권한으로 강제 종료 시도.
  2. 관리자 승인 요청, OTP 3회 실패.
  3. 차단(30분) 확인 후 정상 OTP로 종료.
- **기대 결과**
  - 일반 종료 차단, 감사 로그 100% 기록.
  - KillToken TTL(2분) 만료 시 무효 처리.

### TS-17 설치/삭제 정책 및 복구

- **목적**: 설치/삭제 보호 정책의 종단 흐름을 검증한다.
- **절차**
  1. 설치 전 환경 점검(OS/디스크/네트워크/권한).
  2. 중복 설치 탐지 확인.
  3. 일반 사용자 삭제 시도.
  4. 관리자 승인/토큰 기반 삭제 수행.
- **기대 결과**
  - 일반 삭제 금지, 시도 탐지 시 자동 복구.
  - 복구 실패 시 격리 모드 전환.

### TS-18 시뮬레이터/CI 회귀 시나리오

- **목적**: 핵심 플로우를 자동화해 회귀를 조기 검출한다.
- **절차**
  1. `npm run sim -- --scenario login_success`
  2. `npm run sim -- --scenario update_success`
  3. `npm run sim -- --scenario password_change_confirm`
  4. `npm run sim -- --scenario tamper_attempt`
  5. `npm run sim -- --scenario offline_detected`
- **기대 결과**
  - 각 시나리오 `success=true`, 요구사항 ID/로그코드 매핑 일치.

---

## 5) 우선순위 실행 순서 (권장)

1. **P0(배포 차단급)**: TS-02, TS-03, TS-04, TS-06, TS-10, TS-13, TS-15
2. **P1(보안/운영 핵심)**: TS-07, TS-08, TS-11, TS-16, TS-17
3. **P2(완성도/운영성)**: TS-09, TS-12, TS-14, TS-18

---

## 6) 결과 기록 템플릿

- 테스트 ID:
- 실행 일시/OS/빌드 버전:
- 사전 조건:
- 실행 단계:
- 실제 결과:
- 기대 결과 대비 판정: PASS / FAIL / BLOCK
- 로그/증적 파일 경로:
- 이슈 링크:

