<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>5240 PcOff Agent - 잠금화면</title>
    <link rel="stylesheet" href="./styles.css" />
    <style>
      body {
        user-select: none;
        -webkit-user-select: none;
      }
      .lock-container {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      /* 배경 이미지가 있을 때 .fixed 패널 투명도 0.2, 글자 가독성 보강 */
      body.has-lock-bg .fixed {
        background: rgba(10, 16, 27, 0.2);
        backdrop-filter: blur(6px);
      }
      body.has-lock-bg .fixed .title,
      body.has-lock-bg .fixed .info,
      body.has-lock-bg .fixed .user-display,
      body.has-lock-bg .fixed .logo-text-wrap strong,
      body.has-lock-bg .fixed .logo-text-wrap span,
      body.has-lock-bg .fixed .state-badge,
      body.has-lock-bg .fixed .version-badge,
      body.has-lock-bg .fixed .time-box span,
      body.has-lock-bg .fixed .time-box strong,
      body.has-lock-bg .fixed #date-text,
      body.has-lock-bg .fixed #time-text,
      body.has-lock-bg .fixed .action-link {
        color: #1a1f2e;
        text-shadow: 0 1px 2px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 255, 255, 0.6);
      }
      body.has-lock-bg .fixed .action-link {
        border-color: rgba(26, 31, 46, 0.5);
        background: rgba(255, 255, 255, 0.25);
      }
    </style>
  </head>
  <body>
    <main id="lock-view" class="screen lock-container">
      <section class="fixed">
        <header class="top-box">
          <div class="logo-item">
            <img id="lock-logo-img" src="" alt="" class="lock-logo-img" style="display:none; max-height:32px; max-width:120px; object-fit:contain;" />
            <span class="logo-mark">5240</span>
            <div class="logo-text-wrap">
              <strong>PCOFF AGENT</strong>
              <span>Smart Work Time Control</span>
            </div>
          </div>
          <div class="top-actions">
            <span id="user-display" class="user-display" aria-label="로그인 사용자"></span>
            <span id="app-version" class="version-badge"></span>
            <span id="state-badge" class="state-badge">state: loading</span>
          </div>
        </header>

        <section class="dashboard">
          <h1 id="lock-title" class="title">지금은 PC 화면이 잠겨있습니다.</h1>
          <p id="lock-info" class="info">
            PC 사용이 종료되었습니다. 임시연장은 PC-OFF 시간부터 정책에 따라 사용할 수 있습니다.
          </p>
          <button id="get-attend" class="action-link">나의 근태정보 불러오기</button>
        </section>

        <footer class="bottom-box">
          <div class="button-box">
            <button id="btn-extend" class="button ghost">
              <span>임시연장</span>
              <em id="extend-count" class="badge">0</em>
            </button>
            <button id="btn-use" class="button ghost">
              <span>긴급사용</span>
            </button>
            <button id="btn-emergency-unlock" class="button ghost" style="display:none;">
              <span>긴급해제</span>
            </button>
          </div>
          <div class="time-box">
            <span id="date-text"></span>
            <strong id="time-text">--:--:--</strong>
          </div>
          <div class="button-box right">
            <button id="btn-play" class="button primary">PC-ON</button>
            <button id="btn-off" class="button danger">PC-OFF</button>
          </div>
        </footer>
      </section>
    </main>

    <aside id="attend-panel" class="attend-panel">
      <div class="panel-head">
        <strong>근태정보</strong>
        <button id="close-attend" class="panel-close">닫기</button>
      </div>
      <pre id="attend-content"></pre>
    </aside>

    <div id="toast" class="toast"></div>

    <div id="emergency-modal" class="modal-overlay hidden" aria-label="긴급사용 인증">
      <div class="modal-box">
        <h2 class="modal-title">긴급사용</h2>
        <p class="modal-desc">관리자 또는 시스템에서 발급받은 인증번호를 입력한 뒤 확인을 눌러 주세요.</p>
        <input id="emergency-pass-input" type="password" class="login-input modal-input" placeholder="인증번호" maxlength="20" autocomplete="off" />
        <input id="emergency-reason-input" type="text" class="login-input modal-input" placeholder="예: 긴급 업무 처리" maxlength="200" style="margin-top:8px" />
        <div class="modal-actions">
          <button id="emergency-modal-cancel" class="button ghost">취소</button>
          <button id="emergency-modal-confirm" class="button primary">확인</button>
        </div>
      </div>
    </div>

    <!-- 이석 사유 입력 모달 (screenType=empty, leaveSeatReasonYn=YES, leaveSeatReasonManYn=YES 일 때) -->
    <div id="leave-seat-modal" class="modal-overlay hidden" aria-label="이석 사유 입력">
      <div class="modal-box">
        <h2 class="modal-title">이석 사유 입력</h2>
        <p class="modal-desc" id="leave-seat-desc">자리를 비운 사유를 입력한 뒤 PC-ON 하세요.</p>
        <p id="leave-seat-detected-at" class="modal-hint" style="display:none"></p>
        <input id="leave-seat-reason-input" type="text" class="login-input modal-input" placeholder="예: 회의 참석" maxlength="200" />
        <div class="modal-actions">
          <button id="leave-seat-modal-cancel" class="button ghost">취소</button>
          <button id="leave-seat-modal-confirm" class="button primary">PC-ON</button>
        </div>
      </div>
    </div>

    <!-- FR-14: 이석 해제 비밀번호 (leaveSeatUnlockRequirePassword=true 시) -->
    <div id="leave-seat-unlock-modal" class="modal-overlay hidden" aria-label="이석 해제 비밀번호">
      <div class="modal-box">
        <h2 class="modal-title">이석 해제</h2>
        <p class="modal-desc">비밀번호를 입력한 뒤 PC-ON 하세요.</p>
        <input id="leave-seat-unlock-password" type="password" class="login-input modal-input" placeholder="비밀번호" maxlength="100" autocomplete="off" />
        <input id="leave-seat-unlock-reason" type="text" class="login-input modal-input" placeholder="사유 (선택)" maxlength="200" style="margin-top:8px" />
        <div class="modal-actions">
          <button id="leave-seat-unlock-modal-cancel" class="button ghost">취소</button>
          <button id="leave-seat-unlock-modal-confirm" class="button primary">PC-ON</button>
        </div>
      </div>
    </div>

    <!-- FR-15: 긴급해제 모달 -->
    <div id="emergency-unlock-modal" class="modal-overlay hidden" aria-label="긴급해제">
      <div class="modal-box">
        <h2 class="modal-title">긴급해제</h2>
        <p class="modal-desc">비밀번호를 입력하여 잠금을 해제합니다.</p>
        <input id="emergency-unlock-password" type="password" class="login-input modal-input" placeholder="비밀번호 입력" maxlength="100" autocomplete="off" />
        <p id="emergency-unlock-hint" class="modal-hint" style="display:none;"></p>
        <div class="modal-actions">
          <button id="emergency-unlock-cancel" class="button ghost">취소</button>
          <button id="emergency-unlock-confirm" class="button primary">확인</button>
        </div>
      </div>
    </div>

    <!-- FR-15: 긴급해제 만료 예고 토스트 -->
    <div id="emergency-unlock-expiry-banner" class="toast" style="display:none;background:#e67e22;color:#fff;position:fixed;top:16px;left:50%;transform:translateX(-50%);z-index:9999;padding:10px 24px;border-radius:8px;font-size:14px;"></div>

    <!-- FR-17: 오프라인 유예/잠금 UI -->
    <div id="offline-overlay" class="modal-overlay hidden" aria-label="오프라인 상태">
      <div class="modal-box" style="min-width:420px;text-align:center;">
        <div id="offline-icon" style="font-size:48px;margin-bottom:12px;">⚠️</div>
        <h2 id="offline-title" class="modal-title">네트워크 연결이 끊어졌습니다</h2>
        <p id="offline-desc" class="modal-desc">네트워크 복구까지 남은 시간을 확인하세요.</p>
        <div id="offline-countdown" style="font-size:28px;font-weight:bold;margin:16px 0;font-variant-numeric:tabular-nums;">30:00</div>
        <div class="modal-actions" style="flex-wrap:wrap;gap:8px;">
          <button id="offline-retry-btn" class="button primary">다시 시도</button>
          <button id="offline-settings-btn" class="button ghost" style="display:none;">네트워크 설정</button>
        </div>
        <p id="offline-retry-info" class="modal-hint" style="margin-top:8px;display:none;"></p>
      </div>
    </div>

    <!-- FR-04: 비밀번호 변경 확인 모달 (검증 없이 확인만) -->
    <div id="password-change-modal" class="modal-overlay hidden" aria-label="비밀번호 변경 확인">
      <div class="modal-box">
        <h2 class="modal-title">비밀번호 변경 알림</h2>
        <p id="password-change-message" class="modal-desc">비밀번호가 변경되었습니다.</p>
        <p class="modal-hint">확인 버튼을 눌러 계속 사용하세요. (재로그인이 필요하지 않습니다)</p>
        <div class="modal-actions">
          <button id="password-change-confirm" class="button primary">확인</button>
        </div>
      </div>
    </div>

    <script type="module" src="./lock.js"></script>
  </body>
</html>
