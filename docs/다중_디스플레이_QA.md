# 다중 디스플레이·잠금 화면 QA 시나리오

다음 개발 진행 사항 §7(다중 디스플레이 보완) 및 §11에 따른 QA 체크리스트입니다.  
잠금화면 **alwaysOnTop·포커스 정책**과, 추후 다중 모니터 지원 시 확인할 시나리오를 정리했습니다.

**지금 할 일 (§7 마무리)**  
→ **§3 OS별 우회(Alt+Tab, Mission Control) 수동 QA**를 Windows·macOS 각각에서 수행한 뒤, 아래 체크리스트에 결과를 기록하세요. 이슈가 있으면 증상·OS·재현 단계를 적어 개발에 전달하면 됩니다.

---

## 1. 잠금화면 항상 위 (alwaysOnTop)

| # | 시나리오 | 예상 결과 |
|---|----------|-----------|
| 1.1 | 잠금화면 표시 후 다른 앱(브라우저, 메모장 등)을 연다. | 잠금화면이 다른 창 **위에** 유지된다. |
| 1.2 | 잠금화면에서 PC-ON 또는 긴급사용으로 해제 → 작동정보 화면으로 전환된다. | 해제 후 작동정보 창은 **항상 위가 아니다**(일반 창처럼 다른 앱 뒤로 가질 수 있음). |
| 1.3 | 잠금화면에서 로그아웃(핫키 Cmd/Ctrl+Shift+L) → 로그인 화면으로 전환된다. | 로그인 창은 **항상 위가 아니다**. |

---

## 2. 포커스 정책

| # | 시나리오 | 예상 결과 |
|---|----------|-----------|
| 2.1 | 잠금 필요 시점(종업 경과·이석 감지 등)에 잠금화면이 뜬다. | 잠금화면 창에 **포커스**가 있다. |
| 2.2 | 트레이 메뉴에서 「잠금화면 열기」 또는 핫키(Cmd/Ctrl+Shift+K)로 잠금화면을 연다. | 잠금화면 창에 **포커스**가 있다. |
| 2.3 | 잠금화면이 떠 있는 동안 다른 앱을 클릭해 보려 한다. | (OS에 따라) 잠금창이 항상 위에 있으므로 다른 앱이 완전히 가리기 어렵다. 포커스는 잠금창에 유지되는 것이 바람직하다. |
| 2.4 | **macOS**: Cmd+Tab / **Windows**: Alt+Tab으로 다른 앱으로 전환했다가 다시 에이전트를 선택한다. | 잠금화면이 **다시 맨 앞·전체 화면**으로 복귀한다(blur 시 app.focus(steal)·moveTop·setAlwaysOnTop·setFullScreen·focus 적용). |

---

## 3. OS별 우회 동작 — 수동 QA 체크리스트

**목적**: 사용자가 Alt+Tab(Cmd+Tab) 또는 Mission Control로 다른 앱으로 전환했다가 다시 에이전트를 선택했을 때, 잠금화면이 의도대로 맨 앞·전체 화면으로 복귀하는지 확인합니다.  
**환경**: Windows·macOS 각각에서 아래를 수행하고, 통과 시 ✓, 실패 시 ✗와 증상을 기록하세요.

### 3.1 Windows — Alt+Tab

| 단계 | 동작 | 예상 결과 | 결과 (✓/✗) | 비고 |
|------|------|-----------|------------|------|
| 3.1.1 | 잠금 필요 상태에서 잠금화면이 떠 있는지 확인 | 잠금화면 전체 화면 표시 | | |
| 3.1.2 | **Alt+Tab**으로 다른 앱(예: 브라우저, 메모장)으로 전환 | 다른 앱이 앞으로 옴 | | |
| 3.1.3 | **Alt+Tab**으로 다시 PCOFF 에이전트로 전환 | 잠금화면이 **다시 맨 앞·전체 화면**으로 복귀(blur 핸들러 동작) | | |
| 3.1.4 | (선택) 작업 표시줄에서 에이전트 아이콘 클릭으로 복귀 | 동일하게 잠금화면이 맨 앞·전체 화면으로 복귀 | | |

### 3.2 macOS — Cmd+Tab

| 단계 | 동작 | 예상 결과 | 결과 (✓/✗) | 비고 |
|------|------|-----------|------------|------|
| 3.2.1 | 잠금 필요 상태에서 잠금화면이 떠 있는지 확인 | 잠금화면 전체 화면 표시 | | |
| 3.2.2 | **Cmd+Tab**으로 다른 앱으로 전환 | 다른 앱이 앞으로 옴 | | |
| 3.2.3 | **Cmd+Tab**으로 다시 PCOFF 에이전트로 전환 | 잠금화면이 **다시 맨 앞·전체 화면**으로 복귀(blur 핸들러 동작) | | |
| 3.2.4 | (선택) Dock에서 에이전트 아이콘 클릭으로 복귀 | 동일하게 잠금화면이 맨 앞·전체 화면으로 복귀 | | |

### 3.3 macOS — Mission Control / 멀티 스페이스

| 단계 | 동작 | 예상 결과 | 결과 (✓/✗) | 비고 |
|------|------|-----------|------------|------|
| 3.3.1 | 잠금화면이 떠 있는 상태에서 **Mission Control**(제스처 또는 F3/Control+↑) 진입 | 모든 데스크톱/스페이스에 잠금 창이 보임(setVisibleOnAllWorkspaces) | | |
| 3.3.2 | 다른 스페이스로 전환 후 해당 스페이스에서 에이전트 창 클릭 또는 선택 | 잠금화면이 맨 앞·전체 화면으로 표시됨 | | |

### 3.4 참고 (구현 근거)

- **Windows**: Alt+Tab 시 잠금 화면이 뒤로 가면 **blur** 핸들러에서 잠금창을 다시 앞으로 가져옵니다(§2.4). setAlwaysOnTop level은 Windows에서 무시될 수 있으나, blur 시 focus·moveTop·setFullScreen으로 동일 효과를 목표로 함.
- **macOS**: Cmd+Tab 시 **blur** 핸들러로 잠금창 재진입. Mission Control(스페이스/제스처)으로 데스크톱 전환 시 잠금 창은 **setVisibleOnAllWorkspaces(true)** 로 모든 공간에 표시됩니다.

---

---

## 4. 다중 모니터 (§7·§11 구현 완료)

**현재**: 잠금 시 **디스플레이당 잠금 창 1개** 표시. 주 디스플레이에는 mainWindow, 보조 디스플레이에는 별도 잠금 전용 창(lockWindowsByDisplayId). 해제/로그인 시 보조 잠금창 전부 **풀스크린 해제 → hide → destroy** 순으로 닫아 단일 창으로 전환(Windows에서 보조 모니터에 잠금이 남는 현상 방지).

| # | 시나리오 | 예상 결과 |
|---|----------|-----------|
| 4.1 | 보조 모니터를 연결한 뒤 잠금이 걸린다. | **디스플레이마다 잠금 창 1개**가 뜬다(전체 화면·alwaysOnTop·동일 lock.html). |
| 4.2 | 잠금 표시 중 보조 모니터를 분리(케이블 해제)한다. | 해당 디스플레이용 잠금 창이 **자동 제거**된다(display-removed 핫플러그). |
| 4.3 | 보조 모니터를 다시 연결한다. | **display-added** 시 새 디스플레이에 잠금 창이 자동 생성된다. |

**보조 모니터 배경 이슈**: 보조 모니터 잠금창에는 배경 이미지·디폴트 색상이 적용되지 않는 문제가 있음. 자세한 증상·시도한 대응·현재 상태는 **`docs/보조모니터_이슈.md`** 참고.

---

## 5. 체크리스트 요약

- [ ] 1.1 ~ 1.3: 잠금 시 항상 위, 해제/로그인 시 항상 위 해제
- [ ] 2.1 ~ 2.4: 잠금 시 포커스, Cmd+Tab/Alt+Tab 후 잠금창 재진입
- [ ] **3.1 ~ 3.3: OS별 우회(Alt+Tab, Mission Control) 수동 QA** — Windows §3.1, macOS §3.2·§3.3 수행 후 결과 기록
- [ ] 4.1 ~ 4.3: 다중 모니터 잠금·핫플러그 (§7·§11 구현 완료)

---

## 6. 참고 — 터미널 경고 (macOS)

개발 시 터미널에 `representedObject is not a WeakPtrToElectronMenuModelAsNSObject` 로그가 반복 출력될 수 있다. Electron/Chromium의 macOS 네이티브 메뉴 내부 경고이며, **앱 동작에는 영향 없음**. 무시해도 된다.

완료한 항목은 체크 후, 이슈가 있으면 증상·OS·재현 단계를 기록해 개발에 전달하면 됩니다.
