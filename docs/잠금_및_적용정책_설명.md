# 잠금 화면·적용 정책 동작 설명

## 1. "적용 정책"이란?

작동정보 화면의 **「적용 정책」**은 **현재 표시 기준이 되는 화면 유형(screenType)**입니다.

| 값 | 의미 |
|----|------|
| **before** | 시업 전(출근 전) — 옵션 1227(exCountRenewal) 기준 현재 시각이 일자변경 시각 미만일 때 |
| **off** | 종업 — 현재 시각이 일자변경 시각(exCountRenewal) 미만이거나, 서버가 종업으로 내려준 경우 |
| **empty** | 이석 — 서버/로컬 이석 감지 시 |
| (기타) | 일반 등 |

- **데이터 출처**: `/getPcOffWorkTime.do` 응답 + **옵션 1227(exCountRenewal)** 과 현재 시각으로 `resolveScreenType()`이 계산합니다.
- **용도**: 잠금 화면/작동정보에서 **어떤 문구·화면을 보여줄지** 결정하는 **표시용** 값입니다.  
  즉, "지금이 시업 전인지, 종업인지, 이석인지"를 사용자에게 보여주는 라벨에 해당합니다.

---

## 2. 잠금 화면이 나오는 조건 (실제 잠금 트리거)

**잠금 화면이 실제로 뜨는 시점**은 다음 한 가지입니다.

- **서버가 `pcOnYn === "N"`(사용시간 종료)로 내려줄 때만** 잠금 화면이 표시됩니다.
- 설계상 **서버가 조정해 회신한 값으로만 판단**하며, 클라이언트는 `/getPcOffWorkTime.do` 응답의 `pcOnYn`만 보고 잠금 여부를 결정합니다.

따라서:

- **적용 정책이 "off"(종업)** 이어도, 서버가 아직 `pcOnYn === "Y"`를 주면 **잠금 화면은 뜨지 않습니다.**
- 종업 시간이 지났는데도 잠금이 안 뜨는 경우:
  1. **서버가 아직 `pcOnYn`을 "N"으로 바꾸지 않았을 가능성**이 있습니다.  
     (서버/백엔드에서 종업 시각 경과 시 `pcOnYn`을 "N"으로 내려주는지 확인이 필요합니다.)
  2. 앱은 **1분마다** `getPcOffWorkTime`으로 상태를 조회하고, 그때 `pcOnYn === "N"`이면 잠금 화면을 띄웁니다.  
   - 주기: `LOCK_CHECK_INTERVAL_MS = 60_000`(1분). `startLockCheckInterval()`이 로그인 후 시작되고, 매 1분마다 `checkLockAndShowLockWindow()` → `isLockRequired()` → `getPcOffWorkTime()` 호출.  
   - 로그인 직후·트레이에서 작동정보를 열 때에도 한 번씩 `checkLockAndShowLockWindow()`를 호출해 즉시 잠금 여부를 확인합니다.

**요약**:  
- **적용 정책** = 화면에 표시하는 "지금 시업 전/종업/이석" 라벨 (표시용).  
- **실제 잠금** = 서버가 `pcOnYn="N"`으로 내려줄 때만 동작.  
- 종업 시간이 지났는데도 잠금이 안 뜨면 → 서버에서 해당 사용자/시간대에 `pcOnYn`을 "N"으로 내려주는지 점검해야 합니다.

---

## 3. 잠금 화면이 동작하는 흐름

1. **주기 검사**: 로그인 후 `startLockCheckInterval()`이 **1분 간격**으로 `checkLockAndShowLockWindow()`를 호출합니다.
2. **잠금 여부 판단**: `isLockRequired()`가 `/getPcOffWorkTime.do`를 호출하고, 응답의 **`pcOnYn === "N"`** 이면 `true`를 반환합니다.
3. **화면 전환**: `true`이면 현재 창을 잠금 화면(lock.html)으로 전환하거나, 없으면 새 잠금 창을 띄웁니다.
4. **트레이에서 작동정보 열 때**: 트레이에서 "PCOFF 작동정보"를 열어도, 그 직전에 `checkLockAndShowLockWindow()`를 한 번 호출해, 잠금이 필요하면 **작동정보 대신 잠금 화면**이 나옵니다.

---

## 4. Windows 트레이 아이콘이 비어 보일 때

- 트레이 **칸은 생겼는데 아이콘이 안 보이는** 경우, 패키징된 앱에서 아이콘 파일 경로를 찾지 못했을 수 있습니다.
- 대응: 트레이 아이콘(`assets/tray-icon.png`)을 **extraResources**로 복사해 `process.resourcesPath`에서 읽도록 수정했습니다.  
  새로 빌드·설치 후 트레이 아이콘이 보이는지 확인해 보시고, 여전히 비어 있으면 작업 표시줄(라이트/다크) 대비가 잘 드러나는 아이콘 이미지로 교체하는 것을 권장합니다.
