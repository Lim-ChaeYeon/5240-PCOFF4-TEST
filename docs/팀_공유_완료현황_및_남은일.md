# 팀 공유 — 5240 PcOff 에이전트 완료 현황 및 남은 일

**작성일**: 2026-02-13  
**대상**: 에이전트(Electron 프론트) 저장소 기준. 팀 공유용 요약입니다.  
**상세**: `docs/다음_개발_진행_사항.md`, `docs/개발_이력_리포트.md` 참고.

---

## 1. 완료된 내용 (에이전트/프론트 기준)

에이전트에서 구현·검증을 마친 항목입니다. 서버 API가 이미 있는 기능은 연동 완료, 서버가 없는 기능은 호출부·Fallback·스크립트까지 준비된 상태입니다.

| 구분 | 완료 내용 |
|------|-----------|
| **로그인·로그아웃** | 2단계 로그인(전화번호→서비스영역 조회→선택·ID·비밀번호), state.json 저장, 로그아웃 완전 초기화, 전역 핫키(Cmd/Ctrl+Shift+L), Windows 설치 앱 트레이·창 표시 |
| **메인(잠금) 화면** | 근태정보 조회, 버튼 4종(임시연장·긴급사용·PC-ON·PC-OFF), 시업/종업 화면 로직(FR-13), 임시연장 횟수 소진 시 버튼 숨김·잠금화면 배지(pcExCount) 유지, 다중 디스플레이(디스플레이당 잠금창·핫플러그·해제 시 보조창 정리) |
| **API 연동** | getPcOffWorkTime, getPcOffServareaInfo, getPcOffLoginUserInfo, callPcOffTempDelay, callPcOffEmergencyUse, callCmmPcOnOffLogPrc — 6종 Main IPC·Preload·Renderer 연동, API v1.9 필드 반영 |
| **자동 업데이트** | electron-updater 연동, 무확인 다운로드, 재시도 큐, 실패 구분 로깅(UPDATE_SIGNATURE_INVALID 등), SmartScreen 체크리스트 문서 |
| **비밀번호 변경 확인** | pwdChgYn=Y 감지, 확인-only 정책(재로그인 요구 없음), 모달·IPC |
| **Agent Guard** | 무결성 체크·파일 모니터링·자동 복구 트리거·탐지 로그 |
| **Ops Observer** | heartbeat·로그 배치 전송·크래시 감지·오프라인 보고 |
| **오프라인 복구·잠금** | OfflineManager(30분 유예·잠금)·복구 시 연속 성공 2회·잠금 화면 UI |
| **긴급해제** | EmergencyUnlockManager(비밀번호 검증·5회 차단·3시간 만료)·잠금화면 모달·PHP(sendLockPass.php) 우선 검증·404 시 안내 문구. 이석 체크는 긴급해제 중에만 제외(임시연장·긴급사용은 이석 체크 적용). |
| **이석 잠금·해제** | 이석 감지 시 설정된 이석 잠금화면(config.lockScreen.leave) 적용·주/보조 동일 데이터 전달. 이석 화면에서 PC-ON 클릭 시 비밀번호 모달(leaveSeatUnlockRequirePassword)·검증 동작. 보조 모니터 잠금 간혹 미표시 시 500ms 재시도로 보완. |
| **고객사 설정(FR-14)** | lock-policy API·이석해제 비밀번호(verifyLeaveSeatUnlock 호출)·정책 캐시·30분 폴링 |
| **잠금화면·창 관리** | 잠금 시 닫기 차단, 강제 전체 화면·blur 시 재진입(Cmd+Tab/Alt+Tab), 다중 디스플레이, closeAllLockWindows(Windows 보조 모니터 대응) |
| **설치자 레지스트리·인스톨/격리** | installer-registry.json·서버 동기화, 설치/삭제 탐지 로그, 격리 모드(복구 실패 시 잠금만 표시) |
| **이석/절전 감지** | LeaveSeatDetector(Idle/Sleep)·getWorkTime 병합·사유 입력 정책 |
| **트레이·작동정보** | main/lock/login 단일 창 전환, 트레이 아이콘·핫키, getTrayOperationInfo·refreshMyAttendance |
| **이석정보 서버 전송** | LeaveSeatReporter(START/END)·reportLeaveSeatEvent.do·재시도 큐 |
| **CI·릴리스** | GitHub Actions Windows/Mac 빌드·Release 업로드·자동 업데이트 연동 |
| **시뮬레이터** | 11개 시나리오(Flow-01~08, leave_seat_*) — run-all 통과 |
| **추후 1→2→3 준비** | 연동 가이드·서버 구현 완료 조건·통합 스크립트(run-integration-check-1-2-3.mjs)·잠금화면 설정 검증(check-lock-screen-config.mjs)·임시연장 로그 검증(check-temp-extend-reflect.mjs) |

---

## 2. 남은 일 — 프론트에서 진행할 수 없는 항목

아래는 **에이전트(프론트) 단독으로는 완료할 수 없는** 작업입니다. 담당 팀에서 진행 후, 필요 시 에이전트와 연동·E2E만 진행하면 됩니다.

### 2.1 우선 마무리: 서버 구현 후 연동·E2E (1→2→3)

| 순서 | 항목 | 담당 | 프론트에서 불가인 이유 | 서버 구현 후 에이전트 측 진행 |
|------|------|------|------------------------|-------------------------------|
| **1** | 이석 해제 비밀번호 | **서버** | `POST /verifyLeaveSeatUnlock.do`(또는 동일 API)가 서버에 없음. PHP(`leaveSeatUnlockVerifyUrl`)만 쓸 경우 서버 신규 개발 없이 가능. | 앱에서 이석 잠금 → PC-ON → 비밀번호 모달 → 검증 성공/실패 확인. `node scripts/run-integration-check-1-2-3.mjs` 또는 가이드 §1. |
| **2** | 잠금화면 문구 API | **서버(선택)** | `getLockScreenInfo.do` 또는 `GET .../lock-policy` 미구현. 미구현 시에도 에이전트는 config·lockScreenApiUrl Fallback으로 동작. | 터미널 로그로 문구 적용 경로 확인. `node scripts/check-lock-screen-config.mjs`로 Fallback 설정 검증. |
| **3** | 임시연장 서버 반영 | **서버/DB** | `callPcOffTempDelay.do` 수신 후 JsonMapper·프로시저·DB에서 연장 횟수·시각 갱신 로직 구현 필요. 반영 안 되면 getPcOffWorkTime이 0으로 내려와 관리 콘솔에 안 나옴. | 터미널에서 callPcOffTempDelay 응답 vs 직후 getPcOffWorkTime 비교. `node scripts/check-temp-extend-reflect.mjs [logs경로]` 로 로그 검증. |

**참고**: `docs/추후_개발_점검_연동_가이드.md` — 서버 구현 완료 조건·E2E 체크리스트·통합 실행 방법.

---

### 2.2 수동 QA (에이전트 코드 변경 없음)

| 항목 | 담당 | 프론트에서 불가인 이유 | 진행 방법 |
|------|------|------------------------|-----------|
| **다중 디스플레이 §7 — OS별 우회** | **QA/테스트** | Alt+Tab(Cmd+Tab)·Mission Control 등 실제 조작으로 잠금창 재진입 동작 확인 필요. 자동화 불가. | `docs/다중_디스플레이_QA.md` §3.1~3.3 체크리스트를 **Windows·macOS 각각**에서 수행 후 결과(✓/✗)·비고 기록. |

---

### 2.3 백엔드·OS·배포 담당 선행 필요

| 항목 | 담당 | 프론트에서 불가인 이유 | 비고 |
|------|------|------------------------|------|
| **9. Kill 통제 (FR-18)** | **백엔드·OS** | POST /kill-requests, /verify-otp, /kill-execute API 구현 및 OS별 서비스/데몬(사용자 kill 차단) 필요. 에이전트는 로그·API 스텁·kill-control 연동까지 완료. | 백엔드 API·OS 설정 후 에이전트의 스텁만 실제 HTTP로 교체하면 됨. |
| **12. SmartScreen** | **배포/인프라** | Windows Authenticode·macOS notarization 실제 서명·제출. 에이전트는 실패 구분 로깅·체크리스트 문서 반영 완료. | 배포 단계에서 코드 서명·notarization 수행. |
| **13. 패키징·검증** | **배포** | 코드 서명·notarization·DoD 검증. CI 빌드·Release 업로드 자체는 완료. | 배포 직전 검증. |

---

## 3. 요약

- **완료**: 에이전트(프론트)에서 할 수 있는 기능·연동·시뮬레이터·연동 준비(1→2→3)는 **완료** 상태입니다.
- **남은 일**  
  - **1→2→3**: 서버(및 DB) 구현 → 구현 완료 후 에이전트 연동·E2E 점검(가이드·스크립트 준비됨).  
  - **다중 디스플레이 §7**: OS별 우회(Alt+Tab, Mission Control) **수동 QA**만 남음.  
  - **9·12·13**: Kill 통제·SmartScreen·패키징 검증 — 백엔드·OS·배포 담당 진행 후, 필요 시 에이전트는 연동만 추가하면 됨.

---

## 4. 참고 문서

| 문서 | 용도 |
|------|------|
| `docs/다음_개발_진행_사항.md` | 완료 항목 상세·다음 진행 순서·추후 개발 항목 표 |
| `docs/개발_이력_리포트.md` | 차수별 변경 이력(42·43차: 긴급해제 PHP·이석 잠금화면·PC-ON 비밀번호·보조 모니터 등) |
| `docs/추후_개발_점검_연동_가이드.md` | 1→2→3 서버 구현 완료 조건·E2E 체크리스트·통합 실행 스크립트 |
| `docs/다중_디스플레이_QA.md` | 다중 디스플레이·OS별 우회 수동 QA 체크리스트 |
